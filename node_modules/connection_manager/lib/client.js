var util = require('util');
var events = require('events');

function client(raddress, rport, options) {
  var self = this;

  events.EventEmitter.call(this);

  options = options || {};

  self.debug = options.debug || false;

  self.addr = raddress;
  self.port = rport;
  self.activity = Date.now();
  self.rx_packets = 0;
  self.rx_bytes = 0;

  /*
   * Use touch() to mark activity of this client.
   *
   * @return void
   */
  self.touch = function() {
    self.activity = Date.now();
  }

  /**
    * Handles an incoming message.
    *
    * Emits 'action' event.
    *
    * @return void
    */
  self.recv = function(msg) {
    if (self.debug) {
      console.log('Client[' + self.addr + ':' + self.port + '] '
        + 'Message: ' + msg.length + ' bytes');
    }

    self.rx_packets++;
    self.rx_bytes += msg.length;
    self.touch();

    self.emit('action', msg);
  };

  /**
    * Closes this client.
    *
    * Emits 'close' event.
    *
    * @return void
    */
  self.close = function() {
    if (self.debug) {
      console.log('Client[' + self.addr + ':' + self.port + '] '
        + 'connection closed.');
    }

    self.emit('close');
  };
}

util.inherits(client, events.EventEmitter);

exports = module.exports = client;
